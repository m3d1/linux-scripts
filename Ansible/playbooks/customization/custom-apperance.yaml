
---
- name: Custom appearance for ubuntu desktop
  hosts: agents
  become: true
  become_user: root
  vars:
    image_url: "https://ledesk.ma/wp-content/uploads/2025/01/WhatsApp-Image-2025-01-28-at-14.49.14-900x600.jpeg"   # Replace with your URL
    appearance_mode: "auto"                          # Options: auto, dark, light
    wall_dir: "/home/ubuntu/.local/share/backgrounds"
    filename: "{{ image_url | regex_replace('^.*\\/', '') | default('wallpaper-' ~ ansible_date_time.iso8601 ~ '.jpg') }}"
    target_path: "{{ wall_dir }}/{{ filename }}"

  tasks:

    - name: Ensure required packages are installed
      apt:
        name:
          - wget
          - gsettings-desktop-schemas
        state: present
        update_cache: yes

    - name: Ensure wallpaper directory exists
      file:
        path: "{{ wall_dir }}"
        state: directory
        mode: '0755'

    - name: Download wallpaper from URL
      get_url:
        url: "{{ image_url }}"
        dest: "{{ target_path }}"
        mode: '0644'

    - name: Apply wallpaper for dark mode
      command: gsettings set org.gnome.desktop.background picture-uri-dark "file://{{ target_path }}"
      become: false

    - name: Set wallpaper scaling option
      command: gsettings set org.gnome.desktop.background picture-options "zoom"
      become: false

    - name: Try setting GNOME accent color to olive
      command: gsettings set org.gnome.desktop.interface accent-color "olive"
      ignore_errors: true
      become: false

    - name: Fallback to Yaru olive theme if accent-color not supported
      command: gsettings set org.gnome.desktop.interface gtk-theme "Yaru-olive"
      ignore_errors: true
      become: false

    - name: Print completion message
      debug:
        msg: "Wallpaper applied and accent color set to olive"